import{D as e,r as t,o as s,c as i,a,t as o,w as d,b as l,d as r,e as n,l as u,f as c,g as p,T as h,h as g,F as m,i as y,j as w,v as f,k as x,m as v,n as k,p as b,S as _,q as P,s as D,u as E,x as q,y as C,z as B,A as S,B as $,C as A,E as Q,G as L,H as R,I,J as O,K as U,L as F,M as T,N as j,O as M,P as N,Q as H,R as V,U as J,V as K,W as X,X as z,Y as G,Z as W,_ as Y}from"./vendor.c107571e.js";import Z from"https://jspm.dev/better-podcast-parser";import ee from"https://jspm.dev/better-podcast-parser@0.1.16";function te(e){return(new DOMParser).parseFromString(e,"text/html").body.textContent}function se(e,t=125){return e.length>t?e.substr(0,t)+"...":e}function ie(e=0){return new Date(1e3*e).toISOString().substr(11,8)}function ae(t){let s=e.fromObject({seconds:t}).shiftTo("hours","minutes","seconds").toObject(),i="";return s.hours>0&&(i+=s.hours+" hr"),s.minutes>0&&(i+=" "+s.minutes+" min"),s.seconds>0&&(i+=" "+s.seconds+" sec"),i}!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(s){const i=new URL(e,location),a=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((s,o)=>{const d=new URL(e,i);if(self[t].moduleMap[d])return s(self[t].moduleMap[d]);const l=new Blob([`import * as m from '${d}';`,`${t}.moduleMap['${d}']=m;`],{type:"text/javascript"}),r=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(l),onerror(){o(new Error(`Failed to import: ${e}`)),a(r)},onload(){s(self[t].moduleMap[d]),a(r)}});document.head.appendChild(r)})),self[t].moduleMap={}}}("assets/");const oe={data:()=>({expanded:!0}),computed:{playingEpisode(){return this.$store.state.playingEpisode},humanFriendlyDuration(){return ie(this.playingEpisode.duration)},humanFriendlyPlayhead(){return ie(this.playingEpisode.playhead)},paused(){return this.$store.state.paused}},methods:{playOrPause(){this.$store.dispatch("playOrPause")},jumpAhead(){this.$store.dispatch("jumpAhead")},jumpBack(){this.$store.dispatch("jumpBack")},playNext(){this.$store.dispatch("playNext")},playPrev(){this.$store.dispatch("playPrev")},setPlayhead(e){this.$store.dispatch("setPlayhead",e.target.value)}}},de={key:0},le={key:0,class:"h-48 bg-gray-200"},re={class:"p-3 h-full flex flex-col justify-between sm:justify-around"},ne={class:"flex justify-between"},ue={class:"flex flex-col w-4/5"},ce={class:"w-full text-gray-800 text-sm"},pe={class:"w-full whitespace-no-wrap overflow-x-hidden"},he={class:"hidden md:block"},ge={class:"flex justify-end items-start w-1/5"},me={class:"flex flex-col justify-between h-full sm:flex-row sm:items-center"},ye={class:"flex justify-between sm:w-2/5 lg:w-1/4"},we={class:"sm:flex-1 sm:ml-8"},fe={class:"flex items-center justify-between"},xe={class:"relative w-full"};oe.render=function(e,n,u,c,p,h){var g,m,y,w;const f=t("marquee"),x=t("font-awesome-icon");return h.playingEpisode?(s(),i("div",de,[p.expanded?(s(),i("div",le,[a("div",re,[a("div",ne,[a("div",ue,[a("div",ce,o(null==(y=null==(m=null==(g=h.playingEpisode)?void 0:g.podcast)?void 0:m.meta)?void 0:y.title),1),a("div",pe,[a(f,{class:"md:hidden",scrollamount:"4"},{default:d((()=>{var e;return[l(o(null==(e=h.playingEpisode)?void 0:e.title),1)]})),_:1}),a("div",he,o(null==(w=h.playingEpisode)?void 0:w.title),1)])]),a("div",ge,[a(x,{icon:"chevron-down",class:"text-4xl",onClick:n[1]||(n[1]=e=>p.expanded=!1)})])]),a("div",me,[a("div",ye,[a(x,{icon:"step-backward",class:"text-4xl",onClick:h.playPrev},null,8,["onClick"]),a(x,{icon:"undo",class:"text-4xl",onClick:h.jumpBack},null,8,["onClick"]),h.paused?(s(),i(x,{key:0,icon:"play",class:"text-4xl text-teal-500",onClick:h.playOrPause},null,8,["onClick"])):(s(),i(x,{key:1,icon:"pause",class:"text-4xl text-teal-500",onClick:h.playOrPause},null,8,["onClick"])),a(x,{icon:"redo",class:"text-4xl",onClick:h.jumpAhead},null,8,["onClick"]),a(x,{icon:"step-forward",class:"text-4xl",onClick:h.playNext},null,8,["onClick"])]),a("div",we,[a("div",null,o(h.humanFriendlyPlayhead)+" / "+o(h.humanFriendlyDuration),1),a("div",null,[a("div",fe,[a("div",xe,[a("input",{id:"play-slider",class:"w-full appearance-none bg-gray-200",type:"range",min:"0",max:h.playingEpisode.duration,value:h.playingEpisode.playhead,onChange:n[2]||(n[2]=(...e)=>h.setPlayhead&&h.setPlayhead(...e))},null,40,["max","value"])])])])])])])])):(s(),i("div",{key:1,class:"h-12 bg-gray-200 flex items-center justify-center",onClick:n[3]||(n[3]=e=>p.expanded=!0)},[a(x,{icon:"chevron-up",class:"text-4xl"})]))])):r("",!0)};let ve={dexieDB:null,playingAudio:null,wakeLock:null},ke=n({state:()=>({queue:[],playingEpisode:null,paused:!0,downloading:[],downloaded:[],queueChanging:!1}),getters:{currentlyPlayingInQueue:e=>e.queue.filter((e=>1==e.currently_playing))[0],getEpisodeInQueue:e=>t=>e.queue.filter((e=>e._id==t))[0],isInQueue:e=>t=>e.queue.map((e=>e._id)).includes(t),queueInOrder:e=>u.sortBy(e.queue,["queue"]),isPlaying:e=>t=>{var s;return(null==(s=e.playingEpisode)?void 0:s._id)==t&&!e.paused}},mutations:{addEpisodeToQueue(e,t){e.queue.push(t)},clearQueue(e){e.queue=[]},removeEpisodeFromQueue(e,t){let s=u.findIndex(e.queue,(e=>e._id==t));e.queue.splice(s,1)},setQueueOfEpisode(e,t){let s=u.findIndex(e.queue,(e=>e._id==t.episodeID));e.queue[s].queue=t.newQueue},setPlayingEpisode(e,t){delete t.queue,e.playingEpisode=t},updatePlayhead(e,t){e.playingEpisode.playhead=t},setPlayheadOfEpisode(e,t){let s=u.findIndex(e.queue,(e=>e._id==t.episodeID));e.queue[s].playhead=t.newPlayhead},clearCurrentlyPlaying(e){for(let t=0;t<e.queue.length;t++)e.queue[t].currently_playing=0},setCurrentlyPlaying(e,t){let s=u.findIndex(e.queue,(e=>e._id==t));e.queue[s].currently_playing=1},addEpisodeToDownloading(e,t){e.downloading.push({id:t,progress:0})},setEpisodeDownloadingProgress(e,t){let s=u.findIndex(e.downloading,(e=>e.id==t.id));e.downloading[s].progress=t.progress},removeEpisodeFromDownloading(e,t){let s=u.findIndex(e.downloading,(e=>e.id==t));e.downloading.splice(s,1)},addEpisodeToDownloaded(e,t){e.downloaded.push(t)},setQueueChanging(e,t){e.queueChanging=t}},actions:{getQueue:e=>(e.commit("clearQueue"),ve.dexieDB.episodes.where("queue").above(0).toArray().then((e=>e.map((async e=>(e.podcast=await ve.dexieDB.podcasts.where({_id:e.podcast_id}).first(),e))))).then((e=>Promise.all(e))).then((t=>{let s=u.sortBy(t,["queue"]);for(let i of s)e.commit("addEpisodeToQueue",i)}))),removeEpisodeFromQueue(e,t){e.commit("setQueueChanging",!0);let s=e.state.queue.filter((e=>t==e._id))[0];return ve.dexieDB.episodes.where({_id:t}).modify({queue:0}).then((()=>(e.commit("removeEpisodeFromQueue",t),ve.dexieDB.episodes.where("queue").above(s.queue).toArray()))).then((t=>{let s=[];if(t.length>0){for(let i of t)i.queue-=1,s.push(ve.dexieDB.episodes.where({_id:i._id}).modify({queue:i.queue}).then((()=>{e.commit("setQueueOfEpisode",{episodeID:i._id,newQueue:i.queue})})));return Promise.all(s).then((()=>{e.commit("setQueueChanging",!1)}))}return Promise.resolve().then((()=>{e.commit("setQueueChanging",!1)}))}))},async addEpisodeToQueue(e,t){e.commit("setQueueChanging",!0);let s=await ve.dexieDB.episodes.where("queue").above(0).toArray(),i=(s.length>0?Math.max(...s.map((e=>e.queue))):0)+1;await ve.dexieDB.episodes.where({_id:t}).modify({queue:i});let a=await ve.dexieDB.episodes.where({_id:t}).first();a.podcast=await ve.dexieDB.podcasts.where({_id:a.podcast_id}).first(),e.commit("addEpisodeToQueue",a),e.commit("setQueueChanging",!1)},async playEpisode(e,t){let s=!ve.playingAudio.paused,i=t.hasOwnProperty("id")?t.id:null,a=!!t.hasOwnProperty("startPlaying")&&t.startPlaying;ve.playingAudio&&!ve.playingAudio.paused&&ve.playingAudio.pause(),await ve.dexieDB.episodes.filter((e=>1==e.currently_playing)).modify({currently_playing:0}),e.commit("clearCurrentlyPlaying"),e.getters.isInQueue(i)||await e.dispatch("addEpisodeToQueue",i);let o=await ve.dexieDB.episodes.where({_id:i}).first(),d=await ve.dexieDB.podcasts.where({_id:o.podcast_id}).first();o.podcast=d,e.commit("setPlayingEpisode",o),await ve.dexieDB.episodes.where({_id:i}).modify({currently_playing:1}),e.commit("clearCurrentlyPlaying"),e.commit("setCurrentlyPlaying",i);let l=await c.getItem("podrain_episode_"+i);if(l){let e=await l.arrayBuffer(),t=new Blob([e],{type:o.enclosure.type});ve.playingAudio.src=URL.createObjectURL(t)}else ve.playingAudio.src=e.state.playingEpisode.enclosure.url;ve.playingAudio.currentTime=e.state.playingEpisode.playhead,ve.playingAudio.addEventListener("timeupdate",(t=>{e.commit("updatePlayhead",ve.playingAudio.currentTime),e.commit("setPlayheadOfEpisode",{episodeID:e.state.playingEpisode._id,newPlayhead:ve.playingAudio.currentTime})})),ve.playingAudio.load(),(s||a)&&ve.playingAudio.play()},playOrPause(e){ve.playingAudio.paused?ve.playingAudio.play():ve.playingAudio.pause()},jumpAhead(){ve.playingAudio.currentTime+=15},jumpBack(){ve.playingAudio.currentTime-=15},setPlayhead(e,t){ve.playingAudio.currentTime=t,e.commit("updatePlayhead",ve.playingAudio.currentTime)},async playNext(e,t={}){let s=!!t.hasOwnProperty("finishEpisode")&&t.finishEpisode,i=!!t.hasOwnProperty("startPlaying")&&t.startPlaying,a=u.clone(e.state.playingEpisode._id),o=u.sortBy(e.state.queue,["queue"])[0],d=u.reverse(u.sortBy(e.state.queue,["queue"]))[0];if(e.getters.currentlyPlayingInQueue.queue==d.queue)await e.dispatch("playEpisode",{id:o._id,startPlaying:i});else{let t=e.state.queue.filter((t=>t.queue==e.getters.currentlyPlayingInQueue.queue+1))[0];await e.dispatch("playEpisode",{id:t._id,startPlaying:i})}s&&(e.commit("setQueueChanging",!0),await e.dispatch("removeEpisodeFromQueue",a),e.commit("setQueueChanging",!1),await ve.dexieDB.episodes.where({_id:a}).modify({playhead:0,played:!0}),e.dispatch("removeDownload",a))},playPrev(e){if(1==e.getters.currentlyPlayingInQueue.queue){let t=u.reverse(u.sortBy(e.state.queue,["queue"]))[0];e.dispatch("playEpisode",{id:t._id})}else{let t=e.state.queue.filter((t=>t.queue==e.getters.currentlyPlayingInQueue.queue-1))[0];e.dispatch("playEpisode",{id:t._id})}},reorderQueue(e,t){e.commit("setQueueChanging",!0);let s=t.hasOwnProperty("episodeID")?t.episodeID:null,i=t.hasOwnProperty("newOrder")?t.newOrder:null,a=e.state.queue.filter((e=>e._id==s))[0],o=[];if(i<a.queue){let t=e.state.queue.filter((e=>e.queue>=i&&e.queue<a.queue));for(let s of t)o.push(ve.dexieDB.episodes.where({_id:s._id}).modify({queue:s.queue+1}).then((()=>{e.commit("setQueueOfEpisode",{episodeID:s._id,newQueue:s.queue+1})})))}else if(i>a.queue){let t=e.state.queue.filter((e=>e.queue<=i&&e.queue>a.queue));for(let s of t)o.push(ve.dexieDB.episodes.where({_id:s._id}).modify({queue:s.queue-1}).then((()=>{e.commit("setQueueOfEpisode",{episodeID:s._id,newQueue:s.queue-1})})))}return Promise.all([ve.dexieDB.episodes.where({_id:s}).modify({queue:i}).then((()=>{e.commit("setQueueOfEpisode",{episodeID:s,newQueue:i})})),...o]).then((()=>e.commit("setQueueChanging",!1)))},async downloadEpisode(e,t){e.commit("addEpisodeToDownloading",t);let s=localStorage.getItem("proxy_url")||"",i=await p.get(s+e.getters.getEpisodeInQueue(t).enclosure.url,{onDownloadProgress(s){e.commit("setEpisodeDownloadingProgress",{id:t,progress:Math.floor(s.loaded/s.total*100)})},headers:{Accept:"audio/*"},responseType:"arraybuffer"}),a=i.headers["content-type"],o=new Blob([i.data],{type:a});await c.setItem("podrain_episode_"+t,o),e.dispatch("syncDownloadedEpisodes"),e.commit("removeEpisodeFromDownloading",t)},async removeDownload(e,t){await c.getItem("podrain_episode_"+t)&&(await c.removeItem("podrain_episode_"+t),e.dispatch("syncDownloadedEpisodes"))},async syncDownloadedEpisodes(e){let t=(await c.keys()).filter((e=>e.includes("podrain_episode_"))).map((e=>e.substr("podrain_episode_".length)));e.state.downloaded=t},playOrPauseEpisode(e,t){var s;t==(null==(s=e.state.playingEpisode)?void 0:s._id)?e.state.paused?ve.playingAudio.play():ve.playingAudio.pause():e.dispatch("playEpisode",{id:t,startPlaying:!0})}}});const be={components:{Playbox:oe},created(){this.$store.dispatch("syncDownloadedEpisodes"),ve.playingAudio=new Audio,ve.playingAudio.addEventListener("pause",(e=>{this.$store.state.paused=!0})),ve.playingAudio.addEventListener("play",(e=>{this.$store.state.paused=!1})),ve.playingAudio.addEventListener("ended",(e=>{this.$store.dispatch("playNext",{finishEpisode:!0,startPlaying:!0})})),ve.playingAudio.addEventListener("loadedmetadata",(()=>{this.$store.state.playingEpisode.duration=ve.playingAudio.duration})),this.$store.dispatch("getQueue").then((()=>this.$store.state.queue.length>0?ve.dexieDB.episodes.where({currently_playing:1}).toArray().then((e=>{this.$store.dispatch("playEpisode",{id:e[0]._id})})):Promise.resolve())).then((()=>{setInterval((()=>{ve.dexieDB.episodes.where({_id:this.$store.state.playingEpisode._id}).modify({playhead:this.$store.state.playingEpisode.playhead}).then((()=>{this.$store.commit("setPlayheadOfEpisode",{episodeID:this.$store.state.playingEpisode._id,newPlayhead:this.$store.state.playingEpisode.playhead})}))}),5e3)}))}},_e={class:"flex flex-col h-screen"},Pe={class:"flex justify-center bg-teal-800"},De={class:"flex items-center justify-between px-4 text-white h-16 w-full sm:w-2/3 md:w-1/2 lg:w-2/5 xl:w-1/3"},Ee={class:"flex-1 flex justify-center overflow-y-scroll bg-gray-800"};be.render=function(e,o,l,r,n,u){const c=t("font-awesome-icon"),p=t("router-link"),m=t("router-view"),y=t("Playbox");return s(),i("div",_e,[a("div",Pe,[a("div",De,[a(p,{to:"/"},{default:d((()=>[a(c,{class:"text-4xl",icon:"home"})])),_:1}),a(p,{to:"/queue"},{default:d((()=>[a(c,{class:"text-4xl",icon:"list-ol"})])),_:1}),a(p,{to:"/podcasts/create"},{default:d((()=>[a(c,{class:"text-4xl",icon:"plus"})])),_:1}),a(p,{to:"/settings"},{default:d((()=>[a(c,{class:"text-4xl",icon:"cog"})])),_:1})])]),a("div",Ee,[a(m,null,{default:d((({Component:e})=>[a(h,{name:"fade",mode:"out-in"},{default:d((()=>[(s(),i(g(e)))])),_:2},1024)])),_:1})]),a(y)])};const qe={data:()=>({podcasts:[]}),created(){ve.dexieDB.podcasts.toArray().then((e=>{this.podcasts=e}))}},Ce={key:0,class:"\n        grid \n        grid-cols-3 \n        sm:grid-cols-4 \n        md:grid-cols-6 \n        lg:grid-cols-8\n        xl:grid-cols-10\n        2xl:grid-cols-12\n        auto-rows-max\n      "},Be={key:1,class:"text-white h-full flex-1 flex justify-center items-center"},Se={class:"flex flex-col"},$e=l(" There are no podcasts. ");qe.render=function(e,t,o,d,l,r){return l.podcasts.length>0?(s(),i("div",Ce,[(s(!0),i(m,null,y(l.podcasts,(t=>(s(),i("img",{src:t.meta.imageURL,alt:t.meta.title,key:t._id,onClick:s=>e.$router.push(`/podcasts/${t._id}`)},null,8,["src","alt","onClick"])))),128))])):(s(),i("div",Be,[a("div",Se,[$e,a("button",{onClick:t[1]||(t[1]=t=>e.$router.push("/podcasts/create")),class:"mt-2 p-2 bg-green-500"},"Add some!")])]))};const Ae={data:()=>({podcast:{meta:{title:"",imageURL:""}},allEpisodes:[],episodes:[],refreshing:!1,deleting:!1}),computed:{queue(){return this.$store.state.queue},queueChanging(){return this.$store.state.queueChanging}},methods:{getEpisodes(){return ve.dexieDB.episodes.where({podcast_id:this.podcast._id}).reverse().sortBy("pubDate").then((e=>{this.allEpisodes=e,this.episodes=this.allEpisodes.slice(0,10)}))},getMoreEpisodes(){let e=this.allEpisodes.slice(this.episodes.length,this.episodes.length+10);this.episodes=this.episodes.concat(e)},async deletePodcast(){var e=this;this.deleting=!0,await function(t){let s=Promise.resolve();for(let i of t)i.podcast_id==e.podcast._id&&(s=s.then((()=>e.$store.dispatch("removeEpisodeFromQueue",i._id))));return s}(this.$store.state.queue);let t=ve.dexieDB.podcasts.where({_id:this.podcast._id}).delete(),s=ve.dexieDB.episodes.where({podcast_id:this.podcast._id}).delete();await Promise.all([t,s]),this.deleting=!1,this.$router.push("/podcasts")},prepareDescriptionString(e){if(e){return se(te(e))}return"No description available."},prepareDateString:e=>w.fromISO(e).toFormat("D"),prepareHumanFriendlyDuration:e=>ae(e),removeFromQueue(e){this.$store.dispatch("removeEpisodeFromQueue",e)},addToQueue(e){this.$store.dispatch("addEpisodeToQueue",e)},async refreshEpisodes(){this.refreshing=!0;let e=(await Z.parseURL(this.podcast.feed_url,{proxyURL:localStorage.getItem("proxy_url"),getAllPages:!0})).episodes.filter((e=>e&&e.hasOwnProperty("pubDate")&&e.pubDate>u.max(this.episodes.map((e=>e.pubDate))))).map((e=>u.merge(e,{_id:f(),podcast_id:this.podcast._id,queue:0,playhead:0,currently_playing:0,played:!1})));await ve.dexieDB.episodes.bulkAdd(e),await this.getEpisodes(),this.refreshing=!1},playOrPauseEpisode(e){this.$store.dispatch("playOrPauseEpisode",e)},isPlaying(e){return this.$store.getters.isPlaying(e)}},created(){ve.dexieDB.podcasts.where({_id:this.$route.params.id}).toArray().then((e=>(this.podcast=e[0],this.getEpisodes())))}},Qe={class:"responsive-width"},Le={class:"flex flex-col"},Re={class:"flex"},Ie={class:"w-1/3 m-3"},Oe={class:"w-2/3 flex flex-col justify-center text-lg py-3 pr-3"},Ue={class:"text-white font-bold leading-snug"},Fe={class:"mt-3 flex-col"},Te={class:"flex"},je=l(" Refresh "),Me=l(" Delete "),Ne=l(" Search episodes "),He={class:"mx-3 mb-3"},Ve={key:0,class:"w-8 h-8 bg-yellow-500 absolute bottom-0 left-0 flex justify-center items-center"},Je={class:"text-white leading-tight text-xs font-bold truncate"},Ke={class:"flex mt-3"},Xe={class:"w-1/5"},ze={class:"w-4/5 text-xs font-light ml-3 text-gray-300"},Ge={class:"italic"},We={class:"mt-2 font-bold"},Ye={class:"flex"},Ze={class:"flex-1"},et={key:0,class:"bg-gray-500 text-white text-center p-1"};Ae.render=function(e,d,n,u,c,p){const h=t("font-awesome-icon");return s(),i("div",Qe,[a("div",Le,[a("div",Re,[a("div",Ie,[c.podcast?(s(),i("img",{key:0,src:c.podcast.meta.imageURL},null,8,["src"])):r("",!0)]),a("div",Oe,[a("h1",Ue,o(c.podcast.meta.title),1),a("div",Fe,[a("div",Te,[a("button",{class:"text-white bg-indigo-500 p-2 text-sm flex-1",onClick:d[1]||(d[1]=(...e)=>p.refreshEpisodes&&p.refreshEpisodes(...e))},[c.refreshing?(s(),i(h,{key:0,class:"mr-1",icon:"sync",pulse:""})):(s(),i(h,{key:1,class:"mr-1",icon:"sync"})),je]),a("button",{class:"text-white bg-red-500 p-2 text-sm flex-1",onClick:d[2]||(d[2]=(...e)=>p.deletePodcast&&p.deletePodcast(...e))},[c.deleting?(s(),i(h,{key:0,class:"mr-1",icon:"spinner",spin:""})):(s(),i(h,{key:1,class:"mr-1",icon:"times"})),Me])]),a("button",{class:"bg-yellow-500 p-2 text-sm w-full",onClick:d[3]||(d[3]=t=>e.$router.push("/podcasts/"+c.podcast._id+"/search"))},[a(h,{class:"mr-1",icon:"search"}),Ne])])])]),a("ul",He,[(s(!0),i(m,null,y(c.episodes,(t=>(s(),i("li",{class:"flex flex-col mt-3",key:t._id},[a("div",{class:"p-3 relative bg-gray-700",onClick:s=>e.$router.push(`/episodes/${t._id}`)},[t.played?(s(),i("div",Ve,[a(h,{icon:"check"})])):r("",!0),a("div",Je,o(t.title),1),a("div",Ke,[a("div",Xe,[a("img",{src:t.imageURL||c.podcast.meta.imageURL},null,8,["src"])]),a("div",ze,[a("span",Ge,o(p.prepareDateString(t.pubDate)),1),l(" —  "+o(p.prepareDescriptionString(t.description))+" ",1),a("div",We,[a(h,{icon:"clock"}),l(" "+o(p.prepareHumanFriendlyDuration(t.duration)),1)])])])],8,["onClick"]),a("div",Ye,[a("button",{class:"w-1/5 bg-blue-500",onClick:e=>p.playOrPauseEpisode(t._id)},[p.isPlaying(t._id)?(s(),i(h,{key:0,class:"text-white",icon:"pause"})):(s(),i(h,{key:1,class:"text-white",icon:"play"}))],8,["onClick"]),a("div",Ze,[p.queueChanging?(s(),i("div",et," queue changing ")):(s(),i(m,{key:1},[p.queue.map((e=>e._id)).includes(t._id)?(s(),i("button",{key:0,class:"w-full bg-red-500 text-white p-1",onClick:e=>p.removeFromQueue(t._id)},"Remove from queue",8,["onClick"])):(s(),i("button",{key:1,class:"w-full bg-green-500 text-white p-1",onClick:e=>p.addToQueue(t._id)},"Add to queue",8,["onClick"]))],64))])])])))),128))]),a("button",{class:"bg-purple-500 text-white mx-3 mb-3 p-3",onClick:d[4]||(d[4]=(...e)=>p.getMoreEpisodes&&p.getMoreEpisodes(...e))}," Show More ")])])};const tt={data:()=>({proxyURL:localStorage.getItem("proxy_url")||"",restoreStatus:"",restoring:!1,restoreFile:null,wakeLock:!!ve.wakeLock}),methods:{saveProxyURL(){localStorage.setItem("proxy_url",this.proxyURL)},setRestoreFile(e){this.restoreFile=e.target.files[0]},restoreBackup(){this.restoring=!0,this.restoreStatus="Starting restore...",this.restoreFile.text().then((e=>{let t=JSON.parse(e);return this.restoreStatus="Clearing podcasts...",Promise.all([ve.dexieDB.podcasts.clear(),ve.dexieDB.episodes.clear()]).then((()=>(this.restoreStatus="Loading new podcasts...",Promise.all([ve.dexieDB.podcasts.bulkAdd(t.podcasts),ve.dexieDB.episodes.bulkAdd(t.episodes)])))).then((()=>{this.restoring=!1,this.restoreStatus="Podcasts loaded!"}))}))},downloadBackup(){let e=ve.dexieDB.podcasts.toArray(),t=ve.dexieDB.episodes.toArray();Promise.all([e,t]).then((e=>{let t={podcasts:e[0],episodes:e[1]},s=new Blob([JSON.stringify(t)],{type:"text/plain;charset=utf8"});x.saveAs(s,"backup.json")}))}},watch:{wakeLock(e){"wakeLock"in navigator?(e&&!ve.wakeLock&&navigator.wakeLock.request("screen").then((e=>{ve.wakeLock=e})),!e&&ve.wakeLock&&ve.wakeLock.release().then((()=>{ve.wakeLock=null}))):alert("Cannot keep this device awake. 'Keep awake' setting is ignored.")}}},st={class:"responsive-width"},it={class:"p-3 text-white"},at=a("h1",{class:"text-xl text-center"},"Settings",-1),ot={class:"mt-2"},dt=a("label",{for:"wakelock-id"},"Keep awake",-1),lt={class:"mt-2"},rt=l(" Proxy URL "),nt=l(" Save "),ut={class:"mt-6"},ct=l(" Download Backup "),pt=a("h2",{class:"text-white mt-3"},"Restore backup",-1),ht=l(" Restore backup ");tt.render=function(e,d,n,u,c,p){const h=t("font-awesome-icon");return s(),i("div",st,[a("div",it,[at,a("div",ot,[v(a("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":d[1]||(d[1]=e=>c.wakeLock=e),id:"wakelock-id"},null,512),[[k,c.wakeLock]]),dt]),a("div",lt,[rt,v(a("input",{type:"text",class:"w-full p-1 mt-1 text-black","onUpdate:modelValue":d[2]||(d[2]=e=>c.proxyURL=e)},null,512),[[b,c.proxyURL]]),a("button",{class:"w-full bg-green-500 h-8 text-white",onClick:d[3]||(d[3]=(...e)=>p.saveProxyURL&&p.saveProxyURL(...e))},[a(h,{icon:"save",class:"mr-1"}),nt])]),a("div",ut,[a("button",{class:"bg-purple-600 p-1 text-white mr-1 w-full",onClick:d[4]||(d[4]=(...e)=>p.downloadBackup&&p.downloadBackup(...e))},[a(h,{icon:"download",class:"mr-1"}),ct])]),pt,a("input",{type:"file",class:"text-white mt-1",onChange:d[5]||(d[5]=(...e)=>p.setRestoreFile&&p.setRestoreFile(...e))},null,32),c.restoreFile?(s(),i("button",{key:0,class:"bg-orange-600 p-1 text-white mr-1 w-full mt-3",disabled:c.restoring,onClick:d[6]||(d[6]=(...e)=>p.restoreBackup&&p.restoreBackup(...e))},[c.restoring?(s(),i(m,{key:0},[c.restoring?(s(),i(h,{key:0,icon:"spinner",spin:""})):r("",!0),l(" "+o(c.restoreStatus),1)],64)):(s(),i(m,{key:1},[a(h,{icon:"upload",class:"mr-1"}),ht],64))],8,["disabled"])):r("",!0)])])};const gt={computed:{queue(){return this.$store.getters.queueInOrder},downloading(){return this.$store.state.downloading},queueChanging(){return this.$store.state.queueChanging}},methods:{prepareDescriptionString(e){if(e){return se(te(e))}return"No description available."},prepareDateString:e=>w.fromISO(e).toFormat("D"),prepareHumanFriendlyDuration:e=>ae(e),removeFromQueue(e){this.$store.dispatch("removeEpisodeFromQueue",e)},async downloadEpisode(e){this.isDownloaded(e)?this.$store.dispatch("removeDownload",e):this.$store.dispatch("downloadEpisode",e)},isDownloading(e){return this.$store.state.downloading.map((e=>e.id)).includes(e)},downloadProgress(e){return this.$store.state.downloading.filter((t=>t.id==e))[0].progress},isDownloaded(e){return this.$store.state.downloaded.includes(e)},playOrPauseEpisode(e){this.$store.dispatch("playOrPauseEpisode",e)},isPlaying(e){return this.$store.getters.isPlaying(e)},iOS:()=>["iPad","iPhone","iPod","iPad Simulator","iPhone Simulator","iPod Simulator"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document,playedPercent(e,t){return s=e,i=t,Math.floor(s/i*100);var s,i}},mounted(){var e=this;let t=document.getElementById("queue-list");_.create(t,{handle:".queue-dragbar",scroll:!0,animation:150,onUpdate(t){let s=t.newIndex+1,i=t.item.dataset.id;e.$store.dispatch("reorderQueue",{episodeID:i,newOrder:s})}})}},mt={class:"responsive-width"},yt={id:"queue-list",class:"p-3"},wt={key:0,class:"w-8 h-8 bg-yellow-500 absolute bottom-0 left-0 flex justify-center items-center"},ft={class:"text-white leading-tight text-xs font-bold"},xt={class:"flex mt-3"},vt={class:"w-1/5"},kt={class:"w-4/5 text-xs font-light ml-3 text-gray-300"},bt={class:"italic"},_t={class:"mt-2 font-bold"},Pt={class:"flex"},Dt=l(" Remove from queue "),Et={key:0},qt={key:1},Ct={key:2};gt.render=function(e,d,n,u,c,p){const h=t("font-awesome-icon");return s(),i("div",mt,[a("ul",yt,[(s(!0),i(m,null,y(p.queue,(t=>(s(),i("li",{class:"episode-in-queue flex flex-col mt-3",key:t._id,"data-id":t._id},[a("div",{class:["flex",[t.currently_playing?"bg-orange-500":"bg-gray-700"]]},[a("div",{class:"p-3 relative w-full",onClick:s=>e.$router.push("/episodes/"+t._id)},[a("div",{class:"absolute top-0 left-0 h-1 bg-teal-500",style:`width: ${p.playedPercent(t.playhead,t.duration)}%`},null,4),t.played?(s(),i("div",wt,[a(h,{icon:"check"})])):r("",!0),a("div",ft,o(t.title),1),a("div",xt,[a("div",vt,[a("img",{src:t.imageURL||t.podcast.meta.imageURL},null,8,["src"])]),a("div",kt,[a("span",bt,o(p.prepareDateString(t.pubDate)),1),l(" —  "+o(p.prepareDescriptionString(t.description))+" ",1),a("div",_t,[a(h,{icon:"clock"}),l(" "+o(p.prepareHumanFriendlyDuration(t.duration)),1)])])])],8,["onClick"]),a("button",{class:"queue-dragbar bg-purple-500 w-10 text-white",disabled:p.queueChanging},[p.queueChanging?(s(),i(h,{key:0,icon:"spinner",spin:""})):(s(),i(h,{key:1,icon:"bars"}))],8,["disabled"])],2),a("div",Pt,[a("button",{class:"bg-blue-500 text-white px-4",onClick:e=>p.playOrPauseEpisode(t._id)},[p.isPlaying(t._id)?(s(),i(h,{key:0,icon:"pause"})):(s(),i(h,{key:1,icon:"play"}))],8,["onClick"]),a("button",{class:"flex-1 bg-red-500 text-white p-1",onClick:e=>p.removeFromQueue(t._id)},[p.queueChanging?(s(),i(h,{key:0,icon:"spinner",spin:""})):(s(),i(m,{key:1},[Dt],64))],8,["onClick"]),p.iOS()?r("",!0):(s(),i("button",{key:0,class:["text-white w-1/3",[p.isDownloading(t._id)?"bg-gray-500":p.isDownloaded(t._id)?"bg-green-500":"bg-blue-500"]],onClick:e=>p.downloadEpisode(t._id)},[p.isDownloading(t._id)?(s(),i("span",Et,o(p.downloadProgress(t._id)+"%"),1)):p.isDownloaded(t._id)?(s(),i("span",qt,"Downloaded")):(s(),i("span",Ct,"Download"))],10,["onClick"]))])],8,["data-id"])))),128))])])};const Bt={data:()=>({episode:{}}),created(){ve.dexieDB.episodes.where({_id:this.$route.params.id}).toArray().then((e=>{this.episode=e[0]}))}},St={class:"responsive-width"},$t={class:"p-3"},At={class:"text-white text-xl"},Qt={class:"flex mt-3"};Bt.render=function(e,t,d,l,r,n){return s(),i("div",St,[a("div",$t,[a("h1",At,o(r.episode.title),1),a("div",Qt,[a("div",{class:"prose-sm prose-episode-details",innerHTML:r.episode.description},null,8,["innerHTML"])])])])};const Lt={data:()=>({podcast:{},search:"",episodes:[],searchResults:[]}),computed:{queue(){return this.$store.state.queue}},methods:{prepareDescriptionString(e){if(e){return se(te(e),150)}return"No description available."},prepareHumanFriendlyDuration:e=>ae(e),addToQueue(e){this.$store.dispatch("addEpisodeToQueue",e)},removeFromQueue(e){this.$store.dispatch("removeEpisodeFromQueue",e)}},watch:{search:u.debounce((function(e){this.searchResults=this.episodes.filter((t=>{let s=t.description.toLowerCase(),i=t.title.toLowerCase();return s.includes(e.toLowerCase())||i.includes(e.toLowerCase())}))}),1e3)},created(){ve.dexieDB.podcasts.where({_id:this.$route.params.id}).first().then((e=>{this.podcast=e})),ve.dexieDB.episodes.where({podcast_id:this.$route.params.id}).toArray().then((e=>{this.episodes=e}))}},Rt={class:"responsive-width"},It={class:"p-3"},Ot={class:"text-white"},Ut=l("Search episodes in "),Ft={class:"italic"},Tt={class:"bg-gray-700 p-3"},jt={class:"text-xs text-gray-300"},Mt={class:"text-sm mt-2"};Lt.render=function(e,d,r,n,u,c){var p,h;const g=t("font-awesome-icon");return s(),i("div",Rt,[a("div",It,[a("h1",Ot,[Ut,a("span",Ft,o(null==(h=null==(p=u.podcast)?void 0:p.meta)?void 0:h.title),1)]),v(a("input",{class:"p-1 w-full mt-1","onUpdate:modelValue":d[1]||(d[1]=e=>u.search=e)},null,512),[[b,u.search]]),a("ul",null,[(s(!0),i(m,null,y(u.searchResults,(e=>(s(),i("li",{class:"text-white mt-3",key:e._id},[a("div",Tt,[a("h2",null,o(e.title),1),a("p",jt,o(c.prepareDescriptionString(e.description)),1),a("div",Mt,[a(g,{icon:"clock"}),l(" "+o(c.prepareHumanFriendlyDuration(e.duration)),1)])]),c.queue.map((e=>e._id)).includes(e._id)?(s(),i("button",{key:0,class:"bg-red-500 w-full text-white p-1",onClick:t=>c.removeFromQueue(e._id)},"Remove from queue",8,["onClick"])):(s(),i("button",{key:1,class:"bg-green-500 w-full text-white p-1",onClick:t=>c.addToQueue(e._id)},"Add to queue",8,["onClick"]))])))),128))])])])};const Nt={data:()=>({selectedTab:"search",manualRssUrl:"",search:"",searchResults:[],searching:!1,addingSearchedPodcast:{url:"",adding:!1,episodesAdded:0,episodesTotal:0}}),methods:{addManualRssUrl(){this.addPodcast(this.manualRssUrl).then((()=>{this.$router.push("/podcasts")}))},addSearchedPodcast(e){this.addPodcast(e).then((()=>{this.$router.push("/podcasts")}))},addPodcast(e){this.addingSearchedPodcast.url=e;let t=e.replace(/(?!:\/\/):/g,"%3A");return ee.parseURL(t,{proxyURL:localStorage.getItem("proxy_url"),getAllPages:!0}).then((e=>{let s=u.clone(e);delete s.episodes;let i=f();this.addingSearchedPodcast.episodesTotal=e.episodes.length;let a=ve.dexieDB.podcasts.add(u.merge(s,{_id:i,feed_url:t})),o=[];for(let t of e.episodes)o.push(ve.dexieDB.episodes.add(u.merge(t,{_id:f(),podcast_id:i,queue:0,playhead:0,currently_playing:0,played:!1})).then((()=>{this.addingSearchedPodcast.episodesAdded+=1})));return Promise.all([a,...o]).then((()=>{this.addingSearchedPodcast.url="",this.addingSearchedPodcast.adding=!1,this.addingSearchedPodcast.episodesAdded=0,this.addingSearchedPodcast.episodesTotal=0}))}))}},watch:{search:u.debounce((function(e){this.searching=!0;let t="https://itunes.apple.com/search?"+new URLSearchParams({term:e,media:"podcast",entity:"podcast"});fetch(t).then((e=>e.json())).then((e=>{this.searchResults=e.results,this.searching=!1}))}),250)}},Ht={class:"responsive-width"},Vt={class:"p-3"},Jt=a("div",{class:"text-white text-2xl"},"Add Podcast",-1),Kt={class:"flex mt-3"},Xt=l(" Search "),zt=l(" RSS "),Gt={key:0},Wt={key:0,class:"text-white text-center text-4xl mt-6"},Yt={else:"",class:"mt-3"},Zt={class:"w-4/5 p-2 bg-gray-700 flex-1"},es={key:0,class:"text-gray-200 text-sm"},ts={key:1,class:"text-gray-200 text-sm"},ss={key:0,class:"bg-green-500 w-10",disabled:""},is={key:1};Nt.render=function(e,d,l,n,u,c){const p=t("font-awesome-icon");return s(),i("div",Ht,[a("div",Vt,[Jt,a("div",Kt,[a("button",{class:["flex-1 p-3 text-white",["search"==u.selectedTab?"bg-orange-500":"bg-gray-900"]],onClick:d[1]||(d[1]=e=>u.selectedTab="search")},[a(p,{icon:"search"}),Xt],2),a("button",{class:["flex-1 p-3 text-white",["rss"==u.selectedTab?"bg-orange-500":"bg-gray-900"]],onClick:d[2]||(d[2]=e=>u.selectedTab="rss")},[a(p,{icon:"rss"}),zt],2)]),"search"==u.selectedTab?(s(),i("div",Gt,[v(a("input",{type:"text",class:"w-full mt-3 p-1",placeholder:"Podcast title to search...","onUpdate:modelValue":d[3]||(d[3]=e=>u.search=e)},null,512),[[b,u.search]]),u.searching?(s(),i("div",Wt,[a(p,{icon:"spinner",spin:""})])):r("",!0),a("ul",Yt,[(s(!0),i(m,null,y(u.searchResults,(e=>(s(),i("li",{class:"text-white flex mt-3",key:e.collectionId},[a("img",{class:"w-1/5",src:e.artworkUrl100},null,8,["src"]),a("div",Zt,[a("h3",null,o(e.collectionName),1),u.addingSearchedPodcast.url==e.feedUrl?(s(),i("span",es,o(u.addingSearchedPodcast.episodesAdded)+" / "+o(u.addingSearchedPodcast.episodesTotal)+" episodes added",1)):(s(),i("span",ts,o(e.trackCount)+" episodes",1))]),u.addingSearchedPodcast.url==e.feedUrl?(s(),i("button",ss,[a(p,{icon:"spinner",spin:""})])):(s(),i("button",{key:1,class:"bg-green-500 w-10",onClick:t=>c.addSearchedPodcast(e.feedUrl),disabled:""!=u.addingSearchedPodcast.url&&u.addingSearchedPodcast.url!=e.feedUrl},[a(p,{icon:"plus"})],8,["onClick","disabled"]))])))),128))])])):r("",!0),"rss"==u.selectedTab?(s(),i("div",is,[v(a("input",{type:"text",class:"w-full mt-3 p-1",placeholder:"https://example.com/podcast/feed","onUpdate:modelValue":d[4]||(d[4]=e=>u.manualRssUrl=e)},null,512),[[b,u.manualRssUrl]]),a("button",{class:"w-full bg-green-500 mt-3 p-2 text-white",onClick:d[5]||(d[5]=(...e)=>c.addManualRssUrl&&c.addManualRssUrl(...e))},"Submit")])):r("",!0)])])},P.add(D,E,q,C,B,S,$,A,Q,L,R,I,O,U,F,T,j,M,N,H,V,J,K);let as=new X("podrain");as.version(1).stores({podcasts:"&_id",episodes:"&_id,podcast_id,pubDate"}),as.version(2).stores({podcasts:"&_id",episodes:"&_id,podcast_id,pubDate,queue,currently_playing"}).upgrade((e=>e.table("episodes").modify((e=>{e.currently_playing=!0===e.currently_playing?1:0})))),ve.dexieDB=as,c.config({driver:c.INDEXEDDB,name:"Podrain Episodes"});const os=[{path:"/queue",component:gt},{path:"/podcasts/create",component:Nt},{path:"/podcasts/:id/search",component:Lt},{path:"/podcasts/:id",component:Ae},{path:"/podcasts",component:qe},{path:"/episodes/:id",component:Bt},{path:"/settings",component:tt},{path:"/",redirect:"/podcasts"}],ds=z({history:G(),routes:os});W(be).component("font-awesome-icon",Y).use(ds).use(ke).mount("#app"),localStorage.getItem("proxy_url")||localStorage.setItem("proxy_url","https://podrain-proxy.herokuapp.com/");
